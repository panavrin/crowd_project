{"source":"__coffeescriptShare = typeof __coffeescriptShare === 'object' ? __coffeescriptShare : {}; var share = __coffeescriptShare;\nvar ShareJSAceConnector, UndoManager,\n  extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n  hasProp = {}.hasOwnProperty;\n\nrequire('ace/config').set('basePath', '/packages/mizzao_sharejs-ace/ace-builds/src');\n\nUndoManager = require('ace/undomanager').UndoManager;\n\nShareJSAceConnector = (function(superClass) {\n  extend(ShareJSAceConnector, superClass);\n\n  function ShareJSAceConnector() {\n    return ShareJSAceConnector.__super__.constructor.apply(this, arguments);\n  }\n\n  ShareJSAceConnector.prototype.createView = function() {\n    return Blaze.With(Blaze.getData, function() {\n      return Template._sharejsAce;\n    });\n  };\n\n  ShareJSAceConnector.prototype.rendered = function(element) {\n    ShareJSAceConnector.__super__.rendered.apply(this, arguments);\n    this.ace = ace.edit(element);\n    return typeof this.configCallback === \"function\" ? this.configCallback(this.ace) : void 0;\n  };\n\n  ShareJSAceConnector.prototype.connect = function() {\n    this.ace.setReadOnly(true);\n    return ShareJSAceConnector.__super__.connect.apply(this, arguments);\n  };\n\n  ShareJSAceConnector.prototype.attach = function(doc) {\n    ShareJSAceConnector.__super__.attach.apply(this, arguments);\n    doc.attach_ace(this.ace);\n    this.ace.getSession().setUndoManager(new UndoManager);\n    this.ace.setReadOnly(false);\n    return typeof this.connectCallback === \"function\" ? this.connectCallback(this.ace) : void 0;\n  };\n\n  ShareJSAceConnector.prototype.disconnect = function() {\n    var ref;\n    if ((ref = this.doc) != null) {\n      if (typeof ref.detach_ace === \"function\") {\n        ref.detach_ace();\n      }\n    }\n    return ShareJSAceConnector.__super__.disconnect.apply(this, arguments);\n  };\n\n  ShareJSAceConnector.prototype.destroy = function() {\n    var ref;\n    ShareJSAceConnector.__super__.destroy.apply(this, arguments);\n    if ((ref = this.ace) != null) {\n      ref.destroy();\n    }\n    return this.ace = null;\n  };\n\n  return ShareJSAceConnector;\n\n})(ShareJSConnector);\n\nUI.registerHelper(\"sharejsAce\", new Template('sharejsAce', function() {\n  return new ShareJSAceConnector(this).create();\n}));\n","sourceMap":{"version":3,"file":"/client.coffee.js","sourceRoot":"","sources":["/packages/mizzao_sharejs-ace/client.coffee"],"names":[],"mappings":";AACA,IAAA,gCAAA;EAAA;6BAAA;;AAAA,OAAA,CAAQ,YAAR,CAAqB,CAAC,GAAtB,CAA0B,UAA1B,EAAsC,6CAAtC,CAAA,CAAA;;AAAA,WACA,GAAc,OAAA,CAAQ,iBAAR,CAA0B,CAAC,WADzC,CAAA;;AAAA;AAIE,yCAAA,CAAA;;;;GAAA;;AAAA,gCAAA,UAAA,GAAY,SAAA,GAAA;AACV,WAAO,KAAK,CAAC,IAAN,CAAW,KAAK,CAAC,OAAjB,EAA0B,SAAA,GAAA;aAAG,QAAQ,CAAC,YAAZ;IAAA,CAA1B,CAAP,CADU;EAAA,CAAZ,CAAA;;AAAA,gCAGA,QAAA,GAAU,SAAC,OAAD,GAAA;AACR,IAAA,mDAAA,SAAA,CAAA,CAAA;AAAA,IACA,IAAC,CAAA,GAAD,GAAO,GAAG,CAAC,IAAJ,CAAS,OAAT,CADP,CAAA;uDAGA,IAAC,CAAA,eAAgB,IAAC,CAAA,cAJV;EAAA,CAHV,CAAA;;AAAA,gCASA,OAAA,GAAS,SAAA,GAAA;AACP,IAAA,IAAC,CAAA,GAAG,CAAC,WAAL,CAAiB,IAAjB,CAAA,CAAA;WACA,kDAAA,SAAA,EAFO;EAAA,CATT,CAAA;;AAAA,gCAaA,MAAA,GAAQ,SAAC,GAAD,GAAA;AACN,IAAA,iDAAA,SAAA,CAAA,CAAA;AAAA,IACA,GAAG,CAAC,UAAJ,CAAe,IAAC,CAAA,GAAhB,CADA,CAAA;AAAA,IAMA,IAAC,CAAA,GAAG,CAAC,UAAL,CAAA,CAAiB,CAAC,cAAlB,CAAiC,GAAA,CAAA,WAAjC,CANA,CAAA;AAAA,IAOA,IAAC,CAAA,GAAG,CAAC,WAAL,CAAiB,KAAjB,CAPA,CAAA;wDAQA,IAAC,CAAA,gBAAiB,IAAC,CAAA,cATb;EAAA,CAbR,CAAA;;AAAA,gCAwBA,UAAA,GAAY,SAAA,GAAA;AAEV,QAAA,GAAA;;;WAAI,CAAE;;KAAN;WACA,qDAAA,SAAA,EAHU;EAAA,CAxBZ,CAAA;;AAAA,gCA6BA,OAAA,GAAS,SAAA,GAAA;AACP,QAAA,GAAA;AAAA,IAAA,kDAAA,SAAA,CAAA,CAAA;;SAEI,CAAE,OAAN,CAAA;KAFA;WAGA,IAAC,CAAA,GAAD,GAAO,KAJA;EAAA,CA7BT,CAAA;;6BAAA;;GADgC,iBAHlC,CAAA;;AAAA,EAuCE,CAAC,cAAH,CAAkB,YAAlB,EAAoC,IAAA,QAAA,CAAS,YAAT,EAAuB,SAAA,GAAA;AACzD,SAAW,IAAA,mBAAA,CAAoB,IAApB,CAAyB,CAAC,MAA1B,CAAA,CAAX,CADyD;AAAA,CAAvB,CAApC,CAvCA,CAAA","sourcesContent":["# Set asset path in Ace config\nrequire('ace/config').set('basePath', '/packages/mizzao_sharejs-ace/ace-builds/src')\nUndoManager = require('ace/undomanager').UndoManager\n\nclass ShareJSAceConnector extends ShareJSConnector\n  createView: ->\n    return Blaze.With(Blaze.getData, -> Template._sharejsAce)\n\n  rendered: (element) ->\n    super\n    @ace = ace.edit(element)\n    # Configure the editor if specified\n    @configCallback?(@ace)\n\n  connect: ->\n    @ace.setReadOnly(true); # Disable editing until share is connected\n    super\n\n  attach: (doc) ->\n    super\n    doc.attach_ace(@ace)\n    # Reset undo stack, so that we can't undo to an empty document\n    # XXX It seems that we should be able to use getUndoManager().reset()\n    # here, but that doesn't seem to work:\n    # http://japhr.blogspot.com/2012/10/ace-undomanager-and-setvalue.html\n    @ace.getSession().setUndoManager(new UndoManager)\n    @ace.setReadOnly(false)\n    @connectCallback?(@ace)\n\n  disconnect: ->\n    # Detach ace editor, if any\n    @doc?.detach_ace?()\n    super\n\n  destroy: ->\n    super\n    # Meteor._debug \"destroying Ace editor\"\n    @ace?.destroy()\n    @ace = null\n\nUI.registerHelper \"sharejsAce\", new Template('sharejsAce', ->\n  return new ShareJSAceConnector(this).create()\n)\n"]}}